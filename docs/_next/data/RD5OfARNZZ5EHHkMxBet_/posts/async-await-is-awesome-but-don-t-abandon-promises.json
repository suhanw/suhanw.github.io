{"pageProps":{"postData":{"id":"async-await-is-awesome-but-don-t-abandon-promises","contentHtml":"<figure>\n\t<img src='https://miro.medium.com/max/2746/1*vjATL-EAN7xvJf0kjMUh5Q.png'>\n\t<figcaption>Shoutout to <a href=\"https://medium.com/u/4c5633187eea\">Cassidy Williams</a> üòÄ</figcaption>\n</figure>\n<hr>\n<p>Let‚Äôs create a button that will:</p>\n<ul>\n<li>perform an expensive synchronous operation,</li>\n<li>fire 2 AJAX requests, and</li>\n<li>update the DOM based on the AJAX responses.</li>\n</ul>\n<p>Here is the markup.</p>\n<script src='https://gist.github.com/suhanw/b7d915ac044a8934d720629f4466c25e.js'></script>\n<p>Here are the functions. Let‚Äôs also measure the duration of each operation with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure\">Performance API</a>, which visualizes when and how long each function executes on the Chrome DevTools Performance Timeline. (Thanks to <a href=\"https://jsonplaceholder.typicode.com\">JSONPlaceholder</a> for the dummy endpoints.)</p>\n<script src='https://gist.github.com/suhanw/8e984392ffc4974e3654dda7082c6aff.js'></script>\n<hr>\n<p>You‚Äôre still here? Good, here comes the interesting part: writing the <code>onclick</code> handler for the button. Since all the cool kids are doing it, let‚Äôs use <code>async / await</code>.</p>\n<pre><code class=\"language-javascript\">async function handleClick() {\n   someSyncOperation(); // Expensive sync operation \n\n   const postJson = await fetchPost(); // AJAX request #1\n\n   const commentsJson = await fetchComments(); // AJAX request #2\n\n   appendPostDOM(postJson);\n   appendCommentsDOM(commentsJson);\n}\n</code></pre>\n<p>Here is the Performance Timeline after clicking the button.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/1024/1*IPbydXJik0QO9KfFCcx97g.png\" alt=\"\"></p>\n<p>Let‚Äôs take a closer look.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/1024/1*Afxib_uy8WZ53t31PLEX1w.png\" alt=\"\"></p>\n<p>Makes sense, plenty of articles out there about how <code>async / await</code> turns asynchronous code into blocking code. FYI, each bar is about 2 seconds when throttling the network to ‚ÄúSlow 3G‚Äù.</p>\n<p><strong>So a total execution time of 6 seconds.</strong></p>\n<hr>\n<p>OK. The <code>fetchPost</code> and <code>fetchComments</code> can be executed in parallel, so let‚Äôs use the <code>await Promise.all</code> combo.</p>\n<pre><code class=\"language-javascript\">async function handleClick() {\n  someSyncOperation();\n\n  const [postJson, commentsJson] = await Promise.all([\n    fetchPost(), \n    fetchComments()\n  ]);\n\n  appendPostDOM(postJson);\n  appendCommentsDOM(commentsJson);\n}\n</code></pre>\n<p><img src=\"https://cdn-images-1.medium.com/max/1010/1*37EwgrRI3pE2GHO9axxQpA.png\" alt=\"\"></p>\n<p><strong>The total execution time is now 4 seconds since <code>fetchPost</code> and <code>fetchComments</code> execute in parallel.</strong></p>\n<hr>\n<p>OK. Since <code>someSyncOperation</code> is not dependent on the AJAX requests, let‚Äôs see if moving it to the last line in the function speeds things up.</p>\n<pre><code class=\"language-javascript\">async function handleClick() {\n  const [postJson, commentsJson] = await Promise.all([\n    fetchPost(), \n    fetchComments()\n  ]);\n\n  appendPostDOM(postJson);\n  appendCommentsDOM(commentsJson);\n\n  someSyncOperation();\n}\n</code></pre>\n<p><img src=\"https://cdn-images-1.medium.com/max/1024/1*LIFtuI-vycSo2BLz15jZVg.png\" alt=\"\"></p>\n<p><strong>Nope, the total execution time is still 4 seconds.</strong></p>\n<hr>\n<p>OK. It‚Äôs time to go ‚Äúfull <code>Promise</code>‚Äù.</p>\n<pre><code class=\"language-javascript\">function handleClick() {\n  Promise.all([\n    fetchPost(),\n    fetchComments()\n  ]).then(([postJson, commentsJson]) => {\n    appendPostDOM(postJson);\n    appendCommentsDOM(commentsJson)\n  });\n\n  someSyncOperation();\n}\n</code></pre>\n<p><img src=\"https://cdn-images-1.medium.com/max/1000/1*sBJ0Vh_BHYVCzm4BF0dQoQ.png\" alt=\"\"></p>\n<p><strong>Going ‚Äúfull <code>Promise</code>‚Äù cuts total execution time to 2 seconds.</strong></p>\n<p>The reason why this works deserves its own article, but <a href=\"http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\">here is an awesome explainer</a>.</p>\n<p>Today I learned.</p>\n<hr>\n<figure>\n\t<img src='https://cdn-images-1.medium.com/max/720/1*-WWI7e_QvvXBYp7BPzw0PA.jpeg'>\n\t<figcaption>Source: <a href=\"https://programmerhumour.tumblr.com/post/633961754778533888/google-my-saviour\">Programmer Humor</a></figcaption>\n</figure>\n<hr>\n<h3>Bonus</h3>\n<p>For the die-hard <code>async / await</code> fans out there, I learned (literally on the day of writing this story) that the following snippet actually does the same thing. Credit to <a href=\"https://medium.com/better-programming/an-extremely-easy-tip-to-improve-web-performance-with-async-await-b609e7e65744\">this article</a> by <a href=\"https://medium.com/u/994dcd5bc2e8\">Moon</a>.</p>\n<pre><code class=\"language-javascript\">async function handleClick() {\n  const postPromise = fetchPost();\n  const commentsPromise = fetchComments();\n  \n  someSyncOperation();\n  const postJson = await postPromise;\n  const commentsJson = await commentsPromise;\n\n  appendPostDOM(postJson);\n  appendCommentsDOM(commentsJson);\n}\n</code></pre>\n<hr>\n<p>üì´ <em>Hit me up on</em> <a href=\"https://www.linkedin.com/in/suhanwijaya/\"><em>LinkedIn</em></a> <em>or</em> <a href=\"https://twitter.com/suhanw\"><em>Twitter</em></a><em>!</em></p>\n","pin_order":5,"title":"Async/await is awesome, but don‚Äôt abandon Promises","description":"Async/await is awesome, but don‚Äôt abandon Promises","image":"https://miro.medium.com/max/2746/1*vjATL-EAN7xvJf0kjMUh5Q.png","tags":"ui,javascript,webdev,promises","canonical_url":"https://medium.com/javascript-in-plain-english/async-await-is-awesome-but-dont-abandon-promises-f815b3df51dc","date":"2020-11-15"}},"__N_SSG":true}