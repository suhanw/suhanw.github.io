{"pageProps":{"postData":{"id":"masonry-layout-in-react","contentHtml":"<figure>\n    <img src=\"/images/masonry-layout-in-react_cover.jpg\">\n</figure>\n<hr>\n<p>Masonry layout is a popular style of displaying images in a grid-like structure where elements of varying sizes and heights are arranged in a way that creates an uneven or \"staggered\" appearance. This layout style gets its name from the resemblance to the way bricks are arranged in a masonry wall.</p>\n<p>Unlike traditional grid layouts where elements are aligned in neat rows and columns, masonry layout allows for more flexible and dynamic positioning. Each element, such as images or text blocks, is positioned based on available vertical space, filling gaps and creating an overall visually balanced design.</p>\n<p>This layout style is particularly useful when rendering elements of different sizes or aspect ratios, as it can accommodate items with varying heights and widths without leaving excessive empty spaces.</p>\n<hr>\n<h3>Implementation</h3>\n<figure>\n    <img src=\"/images/masonry-layout-in-react_implementation.jpeg\">\n</figure>\n<p>Yes, I know there are a ton of masonry layout libraries out there, but I decided to reinvent the wheel and build a simple version using plain old React, JavaScript, CSS… and cats.</p>\n<p>Here’s the big picture:</p>\n<ol>\n<li>Suppose we have an array of cat images and want a grid layout with 4 columns.</li>\n<li>Render the first 4 cat images in the array to “establish” the 4 columns.</li>\n<li>Every subsequent cat image will then always be stacked on the column with the shortest height.</li>\n</ol>\n<hr>\n<h3>Let’s start with CSS</h3>\n<p>Use Flexbox to style the <code class=\"language-unknown\">container</code> and <code class=\"language-unknown\">column</code> elements. The <code class=\"language-unknown\">container</code> parent vertically aligns the <code class=\"language-unknown\">column</code> elements to the top and renders them in a row. Each <code class=\"language-unknown\">column</code> element renders the <code class=\"language-unknown\">tile</code> elements from top to bottom. All <code class=\"language-unknown\">column</code> elements will occupy equal widths within the <code class=\"language-unknown\">container</code> element.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.container</span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">align-items</span><span class=\"token punctuation\">:</span> flex-start<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.column</span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> column<span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">flex</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Each <code class=\"language-unknown\">tile</code> element contains the <code class=\"language-unknown\">img</code> tag that renders a cat image of varying aspect ratios. The <code class=\"language-unknown\">img</code> tag will expand to 100% width while the height will adjust based on the given image’s aspect ratio.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.tile</span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-flex<span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.tile</span> img</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">%</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>What is the aspect ratio? In the context of images, the aspect ratio determines the shape and proportions of the image. It specifies how wide or tall an image appears relative to its size. By maintaining the aspect ratio, you ensure that the image retains its intended shape without distortion when it is displayed in different dimensions.</p>\n<p>OK cool, let’s move on to JavaScript.</p>\n<hr>\n<h3>React, my old friend</h3>\n<p>In this example, I’m using <a href=\"https://thecatapi.com/\">the Cat API</a> to serve me a list of cat images. Let’s wrap the AJAX request in a <code class=\"language-unknown\">useEffect</code> and store the data in the local state.</p>\n<div class=\"remark-highlight\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>cats<span class=\"token punctuation\">,</span> setCats<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.thecatapi.com/v1/images/search?limit=10'</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">setCats</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The data for each individual cat object looks like this.</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\tid<span class=\"token operator\">:</span> <span class=\"token string\">\"THXQ9Nqie\"</span>\n\turl<span class=\"token operator\">:</span> <span class=\"token string\">\"https://cdn2.thecatapi.com/images/THXQ9Nqie.jpg\"</span>\n\twidth<span class=\"token operator\">:</span> <span class=\"token number\">1080</span>\n\theight<span class=\"token operator\">:</span> <span class=\"token number\">940</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Now, let’s suppose we’re displaying the masonry layout in 4 columns. We need to know the width of the <code class=\"language-unknown\">container</code> element on page load, which we will retrieve via <code class=\"language-unknown\">containerRef</code> .</p>\n<p>We’ll then take the array of cat images fetched from the API and organize them into the columns that will render the most visually balanced masonry grid, which we will store in the <code class=\"language-unknown\">columns</code> state.</p>\n<p>The <code class=\"language-unknown\">columns</code> state is an array of 4 object literals corresponding to the 4 columns, each of which has the <code class=\"language-unknown\">height</code> property that represents the total height of the column and a nested <code class=\"language-unknown\">tiles</code> array that in turn contains the cat objects to be rendered in that given column.</p>\n<div class=\"remark-highlight\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token constant\">NUM_COLUMNS</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> containerRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>columns<span class=\"token punctuation\">,</span> setColumns<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Lastly, this is the logic to execute the “big picture” steps laid out earlier. I commented on the key steps in the code below.</p>\n<div class=\"remark-highlight\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> columns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 1. iterate through each image</span>\n\tcats<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cat<span class=\"token punctuation\">,</span> catIndex</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 2. iterate through each column and identify the shortest column</span>\n\t\t<span class=\"token keyword\">let</span> shortestColumnIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&#x3C;</span> <span class=\"token constant\">NUM_COLUMNS</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>columns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tcolumns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> height<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> tiles<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t\t\t\tshortestColumnIndex <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword control-flow\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\n\t\t\t<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>columns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>height <span class=\"token operator\">&#x3C;</span> columns<span class=\"token punctuation\">[</span>shortestColumnIndex<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>height<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tshortestColumnIndex <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token comment\">// 3. stack the current image under the current shortest column</span>\n\t\tcolumns<span class=\"token punctuation\">[</span>shortestColumnIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">tiles</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t\tcatIndex<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token spread operator\">...</span>cat<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// 4. calculate current image's rendered height based on its aspect ratio</span>\n\t\t<span class=\"token keyword\">const</span> columnWidth <span class=\"token operator\">=</span> containerRef<span class=\"token operator\">?.</span>current<span class=\"token operator\">?.</span>clientWidth <span class=\"token operator\">/</span> <span class=\"token constant\">NUM_COLUMNS</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">const</span> tileHeight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>cat<span class=\"token punctuation\">.</span><span class=\"token property-access\">height</span> <span class=\"token operator\">/</span> cat<span class=\"token punctuation\">.</span><span class=\"token property-access\">width</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> columnWidth<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// 5. update the height of the current column</span>\n\t\tcolumns<span class=\"token punctuation\">[</span>shortestColumnIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">height</span> <span class=\"token operator\">+=</span> tileHeight<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">setColumns</span><span class=\"token punctuation\">(</span>columns<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>cats<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Steps 1 and 2.</strong> As we iterate through each image, find the shortest column at each iteration to which we will stack the current image. This can be done by keeping track of the current height of each column (with the <code class=\"language-unknown\">height</code> property) and identifying the shortest one.</p>\n<p><strong>Step 3.</strong> Once we’ve identified the shortest column, push the current image to the column’s <code class=\"language-unknown\">tiles</code> array.</p>\n<p><strong>Steps 4 and 5.</strong> Calculate the rendered height of the current image by using the <code class=\"language-unknown\">container</code> element’s rendered with divided by the number of columns (in this case <code class=\"language-unknown\">4</code>) and the image's original dimensions (width and height) or aspect ratio, and increment the column’s <code class=\"language-unknown\">height</code> property to reflect the new total height of the current column.</p>\n<hr>\n<h3>Finally, the HTML markup</h3>\n<p>The <code class=\"language-unknown\">container</code> element is assigned the <code class=\"language-unknown\">containerRef</code> variable, which gives us access to the element’s rendered width based on the user’s screen size. Then we simply iterate through each element in the <code class=\"language-unknown\">columns</code> array, key into the <code class=\"language-unknown\">tiles</code> property, and render the list of images in the appropriate columns as determined by the masonry layout logic above.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>section</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{containerRef}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t{columns.map((column, i) => (\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>column<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{i}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t{column.tiles.map((cat) => (\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tile<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{cat.id}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cat-index<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{cat.catIndex}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{cat.url}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{cat.id}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t\t))}\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t))}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>section</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<hr>\n<h3>Tada!</h3>\n<p>Here’s my <a href=\"https://codesandbox.io/s/client-side-events-5grmlk?file=/src/App.js\">CodeSandbox project</a> to see the whole thing come together.</p>\n<figure>\n    <img src=\"/images/masonry-layout-in-react-final.jpg\">\n</figure>\n<p>The original indices from the array of cat images are displayed so you can visually see how the masonry logic determines which column a particular image belongs to.</p>\n<p>Thanks for reading. In a future(ish 😅) article, I may explore adding bells and whistles such as making the React component more reusable, dynamically updating the number of columns based on screen widths, or implementing infinite scroll.</p>\n","pin_order":10,"title":"Masonry layout in React","description":"Using React, CSS Flexbox, and cats to create a masonry grid layout","image":"/images/masonry-layout-in-react_cover.jpg","tags":"ui,javascript,webdev,masonry,css","date":"2023-06-27"}},"__N_SSG":true}