<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CZ0TSM98BL"></script><script>
									window.dataLayer = window.dataLayer || [];
									function gtag(){dataLayer.push(arguments)}
									gtag('js', new Date());
	
									gtag('config', 'G-CZ0TSM98BL');
							</script><meta charSet="utf-8"/><title>Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="title" content="Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya"/><meta name="description" content="Let‚Äôs use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages."/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.suhanwijaya.com/posts/use-github-actions-deploy-nextjs-ssg-site"/><meta property="og:title" content="Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya"/><meta property="og:description" content="Let‚Äôs use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages."/><meta property="og:image" content="https://www.suhanwijaya.com/images/use-github-actions-deploy-nextjs-ssg-site.jpeg"/><meta name="twitter:title" content="Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya"/><meta name="twitter:description" content="Let‚Äôs use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages."/><meta name="twitter:image" content="https://www.suhanwijaya.com/images/use-github-actions-deploy-nextjs-ssg-site.jpeg"/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/styles.7138b2e3.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.7138b2e3.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-5e53dfd826fb0870df0c.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-147ea3ada7109f6dc0bb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/c8817c810ac732b2202d2ab097cea034b8097b3b.0aef9695673ee5c17c2c.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.dae767624ba255a10f93.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-bc363205d93151ffb13d.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.88486d05149e8c8d248a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-f40d678daca5246f0e57.js" as="script"/></head><body><div id="__next"><div class="layout_GvkLX"><nav class="menu_2G6rj"><h2 class="name_10dbC">suhan <br/>wijaya</h2><ul class="menuItems_26ie3"><li class="menuItem_5m-L2"><a href="/#intro">INTRO</a></li><li class="menuItem_5m-L2"><a href="/#about">ABOUT</a></li><li class="menuItem_5m-L2"><a href="/#blog">BLOG</a></li><li class="menuItem_5m-L2"><a href="/#projects">PROJECTS</a></li><li class="menuItem_5m-L2"><a href="/#contact">CONTACT</a></li><li class="menuItem_5m-L2"><a href="/#toolbox">TOOLBOX</a></li></ul><a href="mailto:suhanw@gmail.com" target="_blank" class="email_3kN3h">suhanw@gmail.com</a><div class="social_3_hb2"><a href="https://www.linkedin.com/in/suhanwijaya/" target="_blank"><img src="/images/linked-in.png" alt="Suhan&#x27;s LinkedIn profile"/></a><a href="https://x.com/suhanw" target="_blank"><img src="/images/twitter-x.png" alt="Suhan&#x27;s Twitter profile"/></a><a href="https://github.com/suhanw" target="_blank"><img src="/images/github.png" alt="Suhan&#x27;s GitHub profile"/></a></div><ul class="topMenuItems_3Vx-y"><li class="menuItem_5m-L2"><a href="/#blog">BACK TO HOME</a></li></ul></nav><button class="hamburger_1KX_H"><img src="/images/hamburger.png"/></button><article class="contentWrapper_1Wy1l"><h1 class="title_29RlI">Use GitHub Actions to Deploy a Next.js SSG Site</h1><div class="description_1Da_c">Let‚Äôs use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages.</div><div class="date_2avFh"><time dateTime="2021-09-24">Sep 24, 2021</time><span class="socialIcons_2XzlR"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.suhanwijaya.com/posts/use-github-actions-deploy-nextjs-ssg-site" target="_blank" aria-label="Share this article on LinkedIn"><img src="/images/linkedin-share.png"/></a><a href="https://x.com/intent/tweet?text=Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya%20@suhanw%20https://www.suhanwijaya.com/posts/use-github-actions-deploy-nextjs-ssg-site" target="_blank" aria-label="Share this article on Twitter"><img src="/images/twitter-x-share.png"/></a></span></div><div class="content_33yU5"><figure>
	<img src='/images/use-github-actions-deploy-nextjs-ssg-site.jpeg'>
	<figcaption>Source: <a href="https://www.reddit.com/r/ProgrammerHumor/comments/f0ag3i/automation/">Reddit</a></figcaption>
</figure>
<p>Let's use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages.</p>
<p>For reference, here‚Äôs the¬†<a href="https://github.com/suhanw/suhanw.github.io">Github repo</a>¬†for the code used in this article.</p>
<hr>
<h3>Optional Readings</h3>
<p>This article will be laser-focused on setting up GitHub Actions, so I may gloss over technical details I consider ancillary. Here are some background readings if you're interested:</p>
<ul>
<li>
<p>The <a href="https://nextjs.org/docs/advanced-features/static-html-export">docs</a> on how to build an SSG site with Next.js. For this article, AYNTK is to use the <code class="language-unknown">next build</code> and <code class="language-unknown">next export</code> commands to generate the files for a static site.</p>
</li>
<li>
<p>The <a href="https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site">docs</a> on how to publish a static site on GitHub Pages. For this article, AYNTK is to commit and push the build files within the <code class="language-unknown">docs</code> folder in the project root directory to deploy the site.</p>
</li>
<li>
<p>The <a href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#the-components-of-github-actions">definitions</a> of the different components of a GitHub Actions pipeline.</p>
</li>
</ul>
<hr>
<h3>Big Picture</h3>
<p>Let's create a GitHub Actions pipeline to automate the following steps:</p>
<ol>
<li>Check out the GitHub repo</li>
<li>Setup Node.js</li>
<li>Install dependencies (or use cache if no changes)</li>
<li>Build the files for the static site (or use cache if no changes)</li>
<li>Cache dependencies and source files</li>
<li>Commit and push the build files to the repo</li>
</ol>
<hr>
<h3>Create a Workflow</h3>
<p>GitHub Actions uses YAML syntax to define the events, jobs, and steps. These YAML files are stored in the code repository, in a directory called <code class="language-unknown">.github/workflows</code>. So let's create a YAML file to define the deployment workflow.</p>
<div class="remark-highlight"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># ./.github/workflows/deploy.workflow.yml</span>

<span class="token key atrule">name</span><span class="token punctuation">:</span> deploy<span class="token punctuation">-</span>workflow
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span> <span class="token comment"># [A]</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">deploy-job</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># [B]</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2 <span class="token comment"># [C]</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2 <span class="token comment"># [D]</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'12'</span>
</code></pre></div>
<p>Annotations of the code comments above:</p>
<p><strong>[A]</strong> Pushing a commit to the GitHub repo is the event that triggers the workflow.<br>
<strong>[B]</strong> Configures the job to run on a fresh Ubuntu Linux virtual machine hosted by GitHub (aka the Runner).<br>
<strong>[C]</strong> The <a href="https://github.com/actions/checkout">action</a> to check out the repo and download the code into the Runner.<br>
<strong>[D]</strong> The <a href="https://github.com/actions/setup-node">action</a> to install Node.js in the Runner, and allow us to run <code class="language-unknown">npm</code> commands.</p>
<hr>
<p>Next, add the step to install the project dependencies in the Runner, which include the <code class="language-unknown">next</code> package.</p>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"># ./.github/workflows/deploy.workflow.yml

name: deploy-workflow
on: [push] # [A]
jobs:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> deploy-job:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   runs-on: ubuntu-latest # [B]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   steps:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/checkout@v2 # [C]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/setup-node@v2 # [D]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         node-version: '12'</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     - run: npm install # [E]</span></span>
</code></pre></div>
<p><strong>[E]</strong> Ah, our old friend.</p>
<hr>
<p>Now that the dependencies are installed, let‚Äôs add the step to build the static files.</p>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"># ./.github/workflows/deploy.workflow.yml

name: deploy-workflow
on: [push] # [A]
jobs:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> deploy-job:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   runs-on: ubuntu-latest # [B]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   steps:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/checkout@v2 # [C]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/setup-node@v2 # [D]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         node-version: '12'</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - run: npm install # [E]</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     - run: npm run build # [F]</span></span>
</code></pre></div>
<p><strong>[F]</strong> What the heck is <code class="language-unknown">build</code> you ask? It‚Äôs a script defined in <code class="language-unknown">package.json</code> that runs:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">next build <span class="token operator">&#x26;&#x26;</span> next <span class="token builtin class-name">export</span> -o docs
</code></pre></div>
<p>See the <a href="https://nextjs.org/docs/advanced-features/static-html-export">docs</a>. TL;DR these are the Next.js commands to build the files for the SSG site, and export them to the <code class="language-unknown">docs</code> folder.</p>
<hr>
<p>Lastly, add the step to commit and push the updates to the <code class="language-unknown">docs</code> folder to the repo.</p>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"># ./.github/workflows/deploy.workflow.yml

name: deploy-workflow
on: [push] # [A]
jobs:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> deploy-job:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   runs-on: ubuntu-latest # [B]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   steps:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/checkout@v2 # [C]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/setup-node@v2 # [D]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         node-version: '12'</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - run: npm install # [E]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - run: npm run build # [F]</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         commit_message: Automated publish</span></span>
</code></pre></div>
<p><strong>[G]</strong> This <a href="https://github.com/marketplace/actions/git-auto-commit">action</a> will commit changes made in the Runner environment, and push the commit to the GitHub repo. The default commit message will be ‚ÄúAutomated publish‚Äù.</p>
<p>Now, pushing a change to the repo will automatically deploy my SSG site to GitHub Pages. üéâ</p>
<p>I can now stare at the pipeline in the <a href="https://github.com/suhanw/suhanw.github.io/actions">Actions tab of my GitHub repo</a>.</p>
<hr>
<h3>Caching</h3>
<p>I realized that the job runs a fresh <code class="language-unknown">npm install</code> every time I push a commit. So let's introduce caching so that a fresh install occurs only when <code class="language-unknown">package-lock.json</code> changes.</p>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"># ./.github/workflows/deploy.workflow.yml

name: deploy-workflow
on: [push] # [A]
jobs:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> deploy-job:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   runs-on: ubuntu-latest # [B]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   steps:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/checkout@v2 # [C]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/setup-node@v2 # [D]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         node-version: '12'</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     - uses: actions/cache@v2 # [H]</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         path: ${{ github.workspace }}/node_modules</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}</span>
<span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     - run: npm install # [E]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - run: npm run build # [F]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         commit_message: Automated publish</span></span>
</code></pre></div>
<p><strong>[H]</strong> This <a href="https://github.com/actions/cache">action</a> caches the <code class="language-unknown">node_modules</code> folder across builds, and makes the Runner use the cache as long as  <code class="language-unknown">package-lock.json</code> doesn‚Äôt change.</p>
<p>Additionally, noticed that <code class="language-unknown">next build</code> issues the following warning about lack of caching.</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">warn  - No build cache found. Please configure build caching for faster rebuilds. 
Read more: https://err.sh/next.js/no-cache</code></pre></div>
<p>The warning links you to the <a href="https://nextjs.org/docs/messages/no-cache#github-actions">answer</a> to fix it. Love it.</p>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"># ./.github/workflows/deploy.workflow.yml

name: deploy-workflow
on: [push] # [A]
jobs:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> deploy-job:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   runs-on: ubuntu-latest # [B]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   steps:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/checkout@v2 # [C]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/setup-node@v2 # [D]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         node-version: '12'</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: actions/cache@v2 # [H]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">         path: ${{ github.workspace }}/node_modules</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">         path: |</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">           ${{ github.workspace }}/node_modules</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">           ${{ github.workspace }}/.next/cache # [I]</span>
<span class="token line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}</span>
<span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">         # Generate a new cache whenever packages or source files change.</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-${{ hashFiles('**/*.js') }}</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         # If source files changed but packages didn't, rebuild from a prior cache. </span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">         restore-keys: |</span>
<span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">           ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-</span>
<span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     - run: npm install # [E]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - run: npm run build # [F]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">       with:</span>
<span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">         commit_message: Automated publish</span></span>
</code></pre></div>
<p><strong>[I]</strong> Next.js stores its cache in the <code class="language-unknown">.next/cache</code> directory. This will persist the cache across builds for faster application rebuilds. E.g., if I only updated my codebase but not the dependencies, this avoids re-bundling the dependencies.</p>
<p>Improved deployment time by about ~30%! ü•∞</p>
<hr>
<h3>Read More</h3>
<ul>
<li><a href="https://www.suhanwijaya.com/posts/deploy-react-ssr-to-production">Deploy React SSR to Production</a></li>
<li><a href="https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering">Intro to React Server Side Rendering</a></li>
<li><a href="https://www.suhanwijaya.com/posts/decouple-data-from-ui-with-react-hooks">Decouple Data from UI with React Hooks</a></li>
</ul>
</div><div class="footer_2PjJq"><span class="socialIcons_2XzlR"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.suhanwijaya.com/posts/use-github-actions-deploy-nextjs-ssg-site" target="_blank" aria-label="Share this article on LinkedIn"><img src="/images/linkedin-share.png"/></a><a href="https://x.com/intent/tweet?text=Use GitHub Actions to Deploy a Next.js SSG Site by Suhan Wijaya%20@suhanw%20https://www.suhanwijaya.com/posts/use-github-actions-deploy-nextjs-ssg-site" target="_blank" aria-label="Share this article on Twitter"><img src="/images/twitter-x-share.png"/></a></span></div><div class="author_3TJVZ"><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya"><img src="https://github.com/suhanw.png?size=200"/></a><span>Liked what you&#x27;ve read? <br/><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya">Follow me on LinkedIn!</a></span></div></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"use-github-actions-deploy-nextjs-ssg-site","contentHtml":"\u003cfigure\u003e\n\t\u003cimg src='/images/use-github-actions-deploy-nextjs-ssg-site.jpeg'\u003e\n\t\u003cfigcaption\u003eSource: \u003ca href=\"https://www.reddit.com/r/ProgrammerHumor/comments/f0ag3i/automation/\"\u003eReddit\u003c/a\u003e\u003c/figcaption\u003e\n\u003c/figure\u003e\n\u003cp\u003eLet's use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages.\u003c/p\u003e\n\u003cp\u003eFor reference, here‚Äôs the¬†\u003ca href=\"https://github.com/suhanw/suhanw.github.io\"\u003eGithub repo\u003c/a\u003e¬†for the code used in this article.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003eOptional Readings\u003c/h3\u003e\n\u003cp\u003eThis article will be laser-focused on setting up GitHub Actions, so I may gloss over technical details I consider ancillary. Here are some background readings if you're interested:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://nextjs.org/docs/advanced-features/static-html-export\"\u003edocs\u003c/a\u003e on how to build an SSG site with Next.js. For this article, AYNTK is to use the \u003ccode class=\"language-unknown\"\u003enext build\u003c/code\u003e and \u003ccode class=\"language-unknown\"\u003enext export\u003c/code\u003e commands to generate the files for a static site.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site\"\u003edocs\u003c/a\u003e on how to publish a static site on GitHub Pages. For this article, AYNTK is to commit and push the build files within the \u003ccode class=\"language-unknown\"\u003edocs\u003c/code\u003e folder in the project root directory to deploy the site.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ca href=\"https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#the-components-of-github-actions\"\u003edefinitions\u003c/a\u003e of the different components of a GitHub Actions pipeline.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3\u003eBig Picture\u003c/h3\u003e\n\u003cp\u003eLet's create a GitHub Actions pipeline to automate the following steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCheck out the GitHub repo\u003c/li\u003e\n\u003cli\u003eSetup Node.js\u003c/li\u003e\n\u003cli\u003eInstall dependencies (or use cache if no changes)\u003c/li\u003e\n\u003cli\u003eBuild the files for the static site (or use cache if no changes)\u003c/li\u003e\n\u003cli\u003eCache dependencies and source files\u003c/li\u003e\n\u003cli\u003eCommit and push the build files to the repo\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch3\u003eCreate a Workflow\u003c/h3\u003e\n\u003cp\u003eGitHub Actions uses YAML syntax to define the events, jobs, and steps. These YAML files are stored in the code repository, in a directory called \u003ccode class=\"language-unknown\"\u003e.github/workflows\u003c/code\u003e. So let's create a YAML file to define the deployment workflow.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yaml\"\u003e\u003ccode class=\"language-yaml\"\u003e\u003cspan class=\"token comment\"\u003e# ./.github/workflows/deploy.workflow.yml\u003c/span\u003e\n\n\u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e deploy\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003eworkflow\n\u003cspan class=\"token key atrule\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epush\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# [A]\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003ejobs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003edeploy-job\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e ubuntu\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003elatest \u003cspan class=\"token comment\"\u003e# [B]\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003esteps\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e actions/checkout@v2 \u003cspan class=\"token comment\"\u003e# [C]\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e actions/setup\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003enode@v2 \u003cspan class=\"token comment\"\u003e# [D]\u003c/span\u003e\n        \u003cspan class=\"token key atrule\"\u003ewith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003enode-version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'12'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnnotations of the code comments above:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e[A]\u003c/strong\u003e Pushing a commit to the GitHub repo is the event that triggers the workflow.\u003cbr\u003e\n\u003cstrong\u003e[B]\u003c/strong\u003e Configures the job to run on a fresh Ubuntu Linux virtual machine hosted by GitHub (aka the Runner).\u003cbr\u003e\n\u003cstrong\u003e[C]\u003c/strong\u003e The \u003ca href=\"https://github.com/actions/checkout\"\u003eaction\u003c/a\u003e to check out the repo and download the code into the Runner.\u003cbr\u003e\n\u003cstrong\u003e[D]\u003c/strong\u003e The \u003ca href=\"https://github.com/actions/setup-node\"\u003eaction\u003c/a\u003e to install Node.js in the Runner, and allow us to run \u003ccode class=\"language-unknown\"\u003enpm\u003c/code\u003e commands.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eNext, add the step to install the project dependencies in the Runner, which include the \u003ccode class=\"language-unknown\"\u003enext\u003c/code\u003e package.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e# ./.github/workflows/deploy.workflow.yml\n\nname: deploy-workflow\non: [push] # [A]\njobs:\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e deploy-job:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   runs-on: ubuntu-latest # [B]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   steps:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/checkout@v2 # [C]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/setup-node@v2 # [D]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         node-version: '12'\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm install # [E]\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003e[E]\u003c/strong\u003e Ah, our old friend.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eNow that the dependencies are installed, let‚Äôs add the step to build the static files.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e# ./.github/workflows/deploy.workflow.yml\n\nname: deploy-workflow\non: [push] # [A]\njobs:\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e deploy-job:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   runs-on: ubuntu-latest # [B]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   steps:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/checkout@v2 # [C]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/setup-node@v2 # [D]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         node-version: '12'\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm install # [E]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm run build # [F]\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003e[F]\u003c/strong\u003e What the heck is \u003ccode class=\"language-unknown\"\u003ebuild\u003c/code\u003e you ask? It‚Äôs a script defined in \u003ccode class=\"language-unknown\"\u003epackage.json\u003c/code\u003e that runs:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003enext build \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e next \u003cspan class=\"token builtin class-name\"\u003eexport\u003c/span\u003e -o docs\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSee the \u003ca href=\"https://nextjs.org/docs/advanced-features/static-html-export\"\u003edocs\u003c/a\u003e. TL;DR these are the Next.js commands to build the files for the SSG site, and export them to the \u003ccode class=\"language-unknown\"\u003edocs\u003c/code\u003e folder.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eLastly, add the step to commit and push the updates to the \u003ccode class=\"language-unknown\"\u003edocs\u003c/code\u003e folder to the repo.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e# ./.github/workflows/deploy.workflow.yml\n\nname: deploy-workflow\non: [push] # [A]\njobs:\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e deploy-job:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   runs-on: ubuntu-latest # [B]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   steps:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/checkout@v2 # [C]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/setup-node@v2 # [D]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         node-version: '12'\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm install # [E]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm run build # [F]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         commit_message: Automated publish\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003e[G]\u003c/strong\u003e This \u003ca href=\"https://github.com/marketplace/actions/git-auto-commit\"\u003eaction\u003c/a\u003e will commit changes made in the Runner environment, and push the commit to the GitHub repo. The default commit message will be ‚ÄúAutomated publish‚Äù.\u003c/p\u003e\n\u003cp\u003eNow, pushing a change to the repo will automatically deploy my SSG site to GitHub Pages. üéâ\u003c/p\u003e\n\u003cp\u003eI can now stare at the pipeline in the \u003ca href=\"https://github.com/suhanw/suhanw.github.io/actions\"\u003eActions tab of my GitHub repo\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003eCaching\u003c/h3\u003e\n\u003cp\u003eI realized that the job runs a fresh \u003ccode class=\"language-unknown\"\u003enpm install\u003c/code\u003e every time I push a commit. So let's introduce caching so that a fresh install occurs only when \u003ccode class=\"language-unknown\"\u003epackage-lock.json\u003c/code\u003e changes.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e# ./.github/workflows/deploy.workflow.yml\n\nname: deploy-workflow\non: [push] # [A]\njobs:\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e deploy-job:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   runs-on: ubuntu-latest # [B]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   steps:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/checkout@v2 # [C]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/setup-node@v2 # [D]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         node-version: '12'\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/cache@v2 # [H]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         path: ${{ github.workspace }}/node_modules\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm install # [E]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm run build # [F]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         commit_message: Automated publish\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003e[H]\u003c/strong\u003e This \u003ca href=\"https://github.com/actions/cache\"\u003eaction\u003c/a\u003e caches the \u003ccode class=\"language-unknown\"\u003enode_modules\u003c/code\u003e folder across builds, and makes the Runner use the cache as long as  \u003ccode class=\"language-unknown\"\u003epackage-lock.json\u003c/code\u003e doesn‚Äôt change.\u003c/p\u003e\n\u003cp\u003eAdditionally, noticed that \u003ccode class=\"language-unknown\"\u003enext build\u003c/code\u003e issues the following warning about lack of caching.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003ewarn  - No build cache found. Please configure build caching for faster rebuilds. \nRead more: https://err.sh/next.js/no-cache\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe warning links you to the \u003ca href=\"https://nextjs.org/docs/messages/no-cache#github-actions\"\u003eanswer\u003c/a\u003e to fix it. Love it.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e# ./.github/workflows/deploy.workflow.yml\n\nname: deploy-workflow\non: [push] # [A]\njobs:\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e deploy-job:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   runs-on: ubuntu-latest # [B]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e   steps:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/checkout@v2 # [C]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/setup-node@v2 # [D]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         node-version: '12'\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: actions/cache@v2 # [H]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token deleted-sign deleted\"\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003e         path: ${{ github.workspace }}/node_modules\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         path: |\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e           ${{ github.workspace }}/node_modules\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e           ${{ github.workspace }}/.next/cache # [I]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token deleted-sign deleted\"\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003e         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         # Generate a new cache whenever packages or source files change.\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         key: ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-${{ hashFiles('**/*.js') }}\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         # If source files changed but packages didn't, rebuild from a prior cache. \u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e         restore-keys: |\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e           ${{ runner.os }}-nextjs-${{ hashFiles('**/package-lock.json') }}-\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm install # [E]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - run: npm run build # [F]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e     - uses: stefanzweifel/git-auto-commit-action@v4 # [G]\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e       with:\u003c/span\u003e\n\u003cspan class=\"token line\"\u003e\u003c/span\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e         commit_message: Automated publish\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003e[I]\u003c/strong\u003e Next.js stores its cache in the \u003ccode class=\"language-unknown\"\u003e.next/cache\u003c/code\u003e directory. This will persist the cache across builds for faster application rebuilds. E.g., if I only updated my codebase but not the dependencies, this avoids re-bundling the dependencies.\u003c/p\u003e\n\u003cp\u003eImproved deployment time by about ~30%! ü•∞\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003eRead More\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.suhanwijaya.com/posts/deploy-react-ssr-to-production\"\u003eDeploy React SSR to Production\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering\"\u003eIntro to React Server Side Rendering\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.suhanwijaya.com/posts/decouple-data-from-ui-with-react-hooks\"\u003eDecouple Data from UI with React Hooks\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","pin_order":8,"title":"Use GitHub Actions to Deploy a Next.js SSG Site","description":"Let‚Äôs use GitHub Actions to create a basic deployment pipeline for a Next.js SSG site hosted on Github Pages.","image":"https://www.suhanwijaya.com/images/use-github-actions-deploy-nextjs-ssg-site.jpeg","tags":"nextjs,technology,javascript,github","author":"Suhan Wijaya","date":"2021-09-24"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"use-github-actions-deploy-nextjs-ssg-site"},"buildId":"aNCdvdwLAub2mnjnYUdxe","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e3f124d20a714e6dd239.js"></script><script src="/_next/static/chunks/main-5e53dfd826fb0870df0c.js" async=""></script><script src="/_next/static/chunks/webpack-147ea3ada7109f6dc0bb.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/c8817c810ac732b2202d2ab097cea034b8097b3b.0aef9695673ee5c17c2c.js" async=""></script><script src="/_next/static/chunks/styles.dae767624ba255a10f93.js" async=""></script><script src="/_next/static/chunks/pages/_app-bc363205d93151ffb13d.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.88486d05149e8c8d248a.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-f40d678daca5246f0e57.js" async=""></script><script src="/_next/static/aNCdvdwLAub2mnjnYUdxe/_buildManifest.js" async=""></script><script src="/_next/static/aNCdvdwLAub2mnjnYUdxe/_ssgManifest.js" async=""></script></body></html>