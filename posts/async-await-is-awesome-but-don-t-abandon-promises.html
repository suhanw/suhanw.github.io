<!DOCTYPE html><html><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CZ0TSM98BL"></script><script>
									window.dataLayer = window.dataLayer || [];
									function gtag(){dataLayer.push(arguments)}
									gtag('js', new Date());
	
									gtag('config', 'G-CZ0TSM98BL');
							</script><meta charSet="utf-8"/><title>Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="title" content="Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya"/><meta name="description" content="Async/await is awesome, but don‚Äôt abandon Promises"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.suhanwijaya.com/posts/async-await-is-awesome-but-don-t-abandon-promises"/><meta property="og:title" content="Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya"/><meta property="og:description" content="Async/await is awesome, but don‚Äôt abandon Promises"/><meta property="og:image" content="https://www.suhanwijaya.com/images/async-await-is-awesome-but-don-t-abandon-promises.jpg"/><meta name="twitter:title" content="Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya"/><meta name="twitter:description" content="Async/await is awesome, but don‚Äôt abandon Promises"/><meta name="twitter:image" content="https://www.suhanwijaya.com/images/async-await-is-awesome-but-don-t-abandon-promises.jpg"/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/styles.82d5ccfb.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.82d5ccfb.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-2aa5d59fa2bc0876ec00.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-147ea3ada7109f6dc0bb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/c8817c810ac732b2202d2ab097cea034b8097b3b.0aef9695673ee5c17c2c.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.ce5f4fc5a3df4f0a06e0.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-569eabea28f105ba5387.js" as="script"/><link rel="preload" href="/_next/static/chunks/94c7f71a581012323aaafcd8ec305a3b3ff8b19c.296025ee889b05d87c83.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.76cacd00121b3f4f8856.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-c86422cf736611b2eeb1.js" as="script"/></head><body><div id="__next"><div class="layout_GvkLX"><nav class="menu_2G6rj"><h2 class="name_10dbC">suhan <br/>wijaya</h2><ul class="menuItems_26ie3"><li class="menuItem_5m-L2"><a href="/#intro">INTRO</a></li><li class="menuItem_5m-L2"><a href="/#about">ABOUT</a></li><li class="menuItem_5m-L2"><a href="/#blog">BLOG</a></li><li class="menuItem_5m-L2"><a href="/#projects">PROJECTS</a></li><li class="menuItem_5m-L2"><a href="/#contact">CONTACT</a></li><li class="menuItem_5m-L2"><a href="/#toolbox">TOOLBOX</a></li></ul><a href="mailto:suhanw@gmail.com" target="_blank" class="email_3kN3h">suhanw@gmail.com</a><div class="social_3_hb2"><a href="https://www.linkedin.com/comm/in/suhanwijaya/" target="_blank"><img src="/images/linked-in.png" alt="Suhan&#x27;s LinkedIn profile"/></a><a href="https://x.com/suhanw" target="_blank"><img src="/images/twitter-x.png" alt="Suhan&#x27;s Twitter profile"/></a><a href="https://github.com/suhanw" target="_blank"><img src="/images/github.png" alt="Suhan&#x27;s GitHub profile"/></a></div><ul class="topMenuItems_3Vx-y"><li class="menuItem_5m-L2"><a href="/#blog">BACK TO HOME</a></li></ul></nav><button class="hamburger_3NkcE showHamburger_fsMIb"><img src="/images/hamburger.png"/></button><article class="contentWrapper_1Wy1l"><h1 class="title_29RlI">Async/await is awesome, but don‚Äôt abandon Promises</h1><div class="description_1Da_c">Async/await is awesome, but don‚Äôt abandon Promises</div><div class="date_2avFh"><time dateTime="2020-11-15">Nov 15, 2020</time><span class="socialIcons_2XzlR"><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.suhanwijaya.com/posts/async-await-is-awesome-but-don-t-abandon-promises" target="_blank" aria-label="Share this article on LinkedIn"><img src="/images/linkedin-share.png"/></a><a href="https://x.com/intent/tweet?text=Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya%20@suhanw%20https://www.suhanwijaya.com/posts/async-await-is-awesome-but-don-t-abandon-promises" target="_blank" aria-label="Share this article on Twitter"><img src="/images/twitter-x-share.png"/></a></span></div><div class="content_33yU5"><figure>
	<img src='https://miro.medium.com/max/2746/1*vjATL-EAN7xvJf0kjMUh5Q.png'>
	<figcaption>Shoutout to <a href="https://medium.com/u/4c5633187eea">Cassidy Williams</a> üòÄ</figcaption>
</figure>
<hr>
<p>Let‚Äôs create a button that will:</p>
<ul>
<li>perform an expensive synchronous operation,</li>
<li>fire 2 AJAX requests, and</li>
<li>update the DOM based on the AJAX responses.</li>
</ul>
<p>Here is the markup.</p>
<script src='https://gist.github.com/suhanw/b7d915ac044a8934d720629f4466c25e.js'></script>
<p>Here are the functions. Let‚Äôs also measure the duration of each operation with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure">Performance API</a>, which visualizes when and how long each function executes on the Chrome DevTools Performance Timeline. (Thanks to <a href="https://jsonplaceholder.typicode.com">JSONPlaceholder</a> for the dummy endpoints.)</p>
<script src='https://gist.github.com/suhanw/8e984392ffc4974e3654dda7082c6aff.js'></script>
<hr>
<p>You‚Äôre still here? Good, here comes the interesting part: writing the <code class="language-unknown">onclick</code> handler for the button. Since all the cool kids are doing it, let‚Äôs use <code class="language-unknown">async / await</code>.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">someSyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Expensive sync operation </span>

   <span class="token keyword">const</span> postJson <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AJAX request #1</span>

   <span class="token keyword">const</span> commentsJson <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AJAX request #2</span>

   <span class="token function">appendPostDOM</span><span class="token punctuation">(</span>postJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">appendCommentsDOM</span><span class="token punctuation">(</span>commentsJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Here is the Performance Timeline after clicking the button.</p>
<p><img src="https://cdn-images-1.medium.com/max/1024/1*IPbydXJik0QO9KfFCcx97g.png" alt=""></p>
<p>Let‚Äôs take a closer look.</p>
<p><img src="https://cdn-images-1.medium.com/max/1024/1*Afxib_uy8WZ53t31PLEX1w.png" alt=""></p>
<p>Makes sense, plenty of articles out there about how <code class="language-unknown">async / await</code> turns asynchronous code into blocking code. FYI, each bar is about 2 seconds when throttling the network to ‚ÄúSlow 3G‚Äù.</p>
<p><strong>So a total execution time of 6 seconds.</strong></p>
<hr>
<p>OK. The <code class="language-unknown">fetchPost</code> and <code class="language-unknown">fetchComments</code> can be executed in parallel, so let‚Äôs use the <code class="language-unknown">await Promise.all</code> combo.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">someSyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>postJson<span class="token punctuation">,</span> commentsJson<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">fetchComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">appendPostDOM</span><span class="token punctuation">(</span>postJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">appendCommentsDOM</span><span class="token punctuation">(</span>commentsJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><img src="https://cdn-images-1.medium.com/max/1010/1*37EwgrRI3pE2GHO9axxQpA.png" alt=""></p>
<p><strong>The total execution time is now 4 seconds since <code class="language-unknown">fetchPost</code> and <code class="language-unknown">fetchComments</code> execute in parallel.</strong></p>
<hr>
<p>OK. Since <code class="language-unknown">someSyncOperation</code> is not dependent on the AJAX requests, let‚Äôs see if moving it to the last line in the function speeds things up.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>postJson<span class="token punctuation">,</span> commentsJson<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">fetchComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">appendPostDOM</span><span class="token punctuation">(</span>postJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">appendCommentsDOM</span><span class="token punctuation">(</span>commentsJson<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">someSyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><img src="https://cdn-images-1.medium.com/max/1024/1*LIFtuI-vycSo2BLz15jZVg.png" alt=""></p>
<p><strong>Nope, the total execution time is still 4 seconds.</strong></p>
<hr>
<p>OK. It‚Äôs time to go ‚Äúfull <code class="language-unknown">Promise</code>‚Äù.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fetchComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>postJson<span class="token punctuation">,</span> commentsJson<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">appendPostDOM</span><span class="token punctuation">(</span>postJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">appendCommentsDOM</span><span class="token punctuation">(</span>commentsJson<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">someSyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*sBJ0Vh_BHYVCzm4BF0dQoQ.png" alt=""></p>
<p><strong>Going ‚Äúfull <code class="language-unknown">Promise</code>‚Äù cuts total execution time to 2 seconds.</strong></p>
<p>The reason why this works deserves its own article, but <a href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">here is an awesome explainer</a>.</p>
<p>Today I learned.</p>
<hr>
<figure>
	<img src='https://cdn-images-1.medium.com/max/720/1*-WWI7e_QvvXBYp7BPzw0PA.jpeg'>
	<figcaption>Source: <a href="https://programmerhumour.tumblr.com/post/633961754778533888/google-my-saviour">Programmer Humor</a></figcaption>
</figure>
<hr>
<h3>Bonus</h3>
<p>For the die-hard <code class="language-unknown">async / await</code> fans out there, I learned (literally on the day of writing this story) that the following snippet actually does the same thing. Credit to <a href="https://medium.com/better-programming/an-extremely-easy-tip-to-improve-web-performance-with-async-await-b609e7e65744">this article</a> by <a href="https://medium.com/u/994dcd5bc2e8">Moon</a>.</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> postPromise <span class="token operator">=</span> <span class="token function">fetchPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> commentsPromise <span class="token operator">=</span> <span class="token function">fetchComments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">someSyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> postJson <span class="token operator">=</span> <span class="token keyword control-flow">await</span> postPromise<span class="token punctuation">;</span>
  <span class="token keyword">const</span> commentsJson <span class="token operator">=</span> <span class="token keyword control-flow">await</span> commentsPromise<span class="token punctuation">;</span>

  <span class="token function">appendPostDOM</span><span class="token punctuation">(</span>postJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">appendCommentsDOM</span><span class="token punctuation">(</span>commentsJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div><div class="footer_2PjJq"><span class="socialIcons_2XzlR"><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.suhanwijaya.com/posts/async-await-is-awesome-but-don-t-abandon-promises" target="_blank" aria-label="Share this article on LinkedIn"><img src="/images/linkedin-share.png"/></a><a href="https://x.com/intent/tweet?text=Async/await is awesome, but don‚Äôt abandon Promises by Suhan Wijaya%20@suhanw%20https://www.suhanwijaya.com/posts/async-await-is-awesome-but-don-t-abandon-promises" target="_blank" aria-label="Share this article on Twitter"><img src="/images/twitter-x-share.png"/></a></span></div><div class="author_3TJVZ"><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya"><img src="https://github.com/suhanw.png?size=200"/></a><span>Liked what you&#x27;ve read? <br/><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya">Follow me on LinkedIn!</a></span></div></article><nav class="bottomMenu_SThI5 mobileOnly_bZ-pA"><div class="authorMobile_IHm92"><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya"><img src="https://github.com/suhanw.png?size=200"/></a><span>Liked what you&#x27;ve read? <br/><a href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=suhanwijaya">Follow me on LinkedIn!</a></span></div></nav></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"async-await-is-awesome-but-don-t-abandon-promises","contentHtml":"\u003cfigure\u003e\n\t\u003cimg src='https://miro.medium.com/max/2746/1*vjATL-EAN7xvJf0kjMUh5Q.png'\u003e\n\t\u003cfigcaption\u003eShoutout to \u003ca href=\"https://medium.com/u/4c5633187eea\"\u003eCassidy Williams\u003c/a\u003e üòÄ\u003c/figcaption\u003e\n\u003c/figure\u003e\n\u003chr\u003e\n\u003cp\u003eLet‚Äôs create a button that will:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eperform an expensive synchronous operation,\u003c/li\u003e\n\u003cli\u003efire 2 AJAX requests, and\u003c/li\u003e\n\u003cli\u003eupdate the DOM based on the AJAX responses.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHere is the markup.\u003c/p\u003e\n\u003cscript src='https://gist.github.com/suhanw/b7d915ac044a8934d720629f4466c25e.js'\u003e\u003c/script\u003e\n\u003cp\u003eHere are the functions. Let‚Äôs also measure the duration of each operation with the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure\"\u003ePerformance API\u003c/a\u003e, which visualizes when and how long each function executes on the Chrome DevTools Performance Timeline. (Thanks to \u003ca href=\"https://jsonplaceholder.typicode.com\"\u003eJSONPlaceholder\u003c/a\u003e for the dummy endpoints.)\u003c/p\u003e\n\u003cscript src='https://gist.github.com/suhanw/8e984392ffc4974e3654dda7082c6aff.js'\u003e\u003c/script\u003e\n\u003chr\u003e\n\u003cp\u003eYou‚Äôre still here? Good, here comes the interesting part: writing the \u003ccode class=\"language-unknown\"\u003eonclick\u003c/code\u003e handler for the button. Since all the cool kids are doing it, let‚Äôs use \u003ccode class=\"language-unknown\"\u003easync / await\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleClick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"token function\"\u003esomeSyncOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Expensive sync operation \u003c/span\u003e\n\n   \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e postJson \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003efetchPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// AJAX request #1\u003c/span\u003e\n\n   \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e commentsJson \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003efetchComments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// AJAX request #2\u003c/span\u003e\n\n   \u003cspan class=\"token function\"\u003eappendPostDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"token function\"\u003eappendCommentsDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommentsJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere is the Performance Timeline after clicking the button.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1024/1*IPbydXJik0QO9KfFCcx97g.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eLet‚Äôs take a closer look.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1024/1*Afxib_uy8WZ53t31PLEX1w.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eMakes sense, plenty of articles out there about how \u003ccode class=\"language-unknown\"\u003easync / await\u003c/code\u003e turns asynchronous code into blocking code. FYI, each bar is about 2 seconds when throttling the network to ‚ÄúSlow 3G‚Äù.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSo a total execution time of 6 seconds.\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eOK. The \u003ccode class=\"language-unknown\"\u003efetchPost\u003c/code\u003e and \u003ccode class=\"language-unknown\"\u003efetchComments\u003c/code\u003e can be executed in parallel, so let‚Äôs use the \u003ccode class=\"language-unknown\"\u003eawait Promise.all\u003c/code\u003e combo.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleClick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003esomeSyncOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e commentsJson\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efetchPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"token function\"\u003efetchComments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eappendPostDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eappendCommentsDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommentsJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1010/1*37EwgrRI3pE2GHO9axxQpA.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eThe total execution time is now 4 seconds since \u003ccode class=\"language-unknown\"\u003efetchPost\u003c/code\u003e and \u003ccode class=\"language-unknown\"\u003efetchComments\u003c/code\u003e execute in parallel.\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eOK. Since \u003ccode class=\"language-unknown\"\u003esomeSyncOperation\u003c/code\u003e is not dependent on the AJAX requests, let‚Äôs see if moving it to the last line in the function speeds things up.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleClick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e commentsJson\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efetchPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"token function\"\u003efetchComments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eappendPostDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eappendCommentsDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommentsJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003esomeSyncOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1024/1*LIFtuI-vycSo2BLz15jZVg.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNope, the total execution time is still 4 seconds.\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eOK. It‚Äôs time to go ‚Äúfull \u003ccode class=\"language-unknown\"\u003ePromise\u003c/code\u003e‚Äù.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleClick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token known-class-name class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efetchPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efetchComments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ethen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e commentsJson\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eappendPostDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eappendCommentsDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommentsJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003esomeSyncOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1000/1*sBJ0Vh_BHYVCzm4BF0dQoQ.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eGoing ‚Äúfull \u003ccode class=\"language-unknown\"\u003ePromise\u003c/code\u003e‚Äù cuts total execution time to 2 seconds.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe reason why this works deserves its own article, but \u003ca href=\"http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\"\u003ehere is an awesome explainer\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eToday I learned.\u003c/p\u003e\n\u003chr\u003e\n\u003cfigure\u003e\n\t\u003cimg src='https://cdn-images-1.medium.com/max/720/1*-WWI7e_QvvXBYp7BPzw0PA.jpeg'\u003e\n\t\u003cfigcaption\u003eSource: \u003ca href=\"https://programmerhumour.tumblr.com/post/633961754778533888/google-my-saviour\"\u003eProgrammer Humor\u003c/a\u003e\u003c/figcaption\u003e\n\u003c/figure\u003e\n\u003chr\u003e\n\u003ch3\u003eBonus\u003c/h3\u003e\n\u003cp\u003eFor the die-hard \u003ccode class=\"language-unknown\"\u003easync / await\u003c/code\u003e fans out there, I learned (literally on the day of writing this story) that the following snippet actually does the same thing. Credit to \u003ca href=\"https://medium.com/better-programming/an-extremely-easy-tip-to-improve-web-performance-with-async-await-b609e7e65744\"\u003ethis article\u003c/a\u003e by \u003ca href=\"https://medium.com/u/994dcd5bc2e8\"\u003eMoon\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ehandleClick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e postPromise \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003efetchPost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e commentsPromise \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003efetchComments\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \n  \u003cspan class=\"token function\"\u003esomeSyncOperation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e postJson \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e postPromise\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e commentsJson \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e commentsPromise\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eappendPostDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epostJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003eappendCommentsDOM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecommentsJson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n","pin_order":2,"title":"Async/await is awesome, but don‚Äôt abandon Promises","description":"Async/await is awesome, but don‚Äôt abandon Promises","image":"https://www.suhanwijaya.com/images/async-await-is-awesome-but-don-t-abandon-promises.jpg","tags":"ui,javascript,webdev,promises","date":"2020-11-15"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"async-await-is-awesome-but-don-t-abandon-promises"},"buildId":"SYyX0_UeGYpMU8KWpr_L6","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-bd76d82fced59b097afe.js"></script><script src="/_next/static/chunks/main-2aa5d59fa2bc0876ec00.js" async=""></script><script src="/_next/static/chunks/webpack-147ea3ada7109f6dc0bb.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/c8817c810ac732b2202d2ab097cea034b8097b3b.0aef9695673ee5c17c2c.js" async=""></script><script src="/_next/static/chunks/styles.ce5f4fc5a3df4f0a06e0.js" async=""></script><script src="/_next/static/chunks/pages/_app-569eabea28f105ba5387.js" async=""></script><script src="/_next/static/chunks/94c7f71a581012323aaafcd8ec305a3b3ff8b19c.296025ee889b05d87c83.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.76cacd00121b3f4f8856.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c86422cf736611b2eeb1.js" async=""></script><script src="/_next/static/SYyX0_UeGYpMU8KWpr_L6/_buildManifest.js" async=""></script><script src="/_next/static/SYyX0_UeGYpMU8KWpr_L6/_ssgManifest.js" async=""></script></body></html>